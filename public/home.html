<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å·²é ˜é¤Šåå–®ï½œå°ä¸­ç°¡åª½åª½ç‹—åœ’</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="firebase-config.js"></script>
  <style>
    body.modal-open { overflow: hidden; }
    #thumbs img, #adopt-photos img { width: 60px; height: 60px; object-fit: cover; border-radius: .5rem; cursor: pointer; }
  </style>
</head>
<body class="bg-[#fdf6f7] text-gray-800 min-h-screen">

<header class="p-4 text-center">
  <h1 class="text-3xl font-bold text-rose-600 mb-1">å¹¸ç¦åå–®</h1>
  <p class="text-sm text-gray-600">é€™äº›æ¯›å­©éƒ½æ‰¾åˆ°æ–°å®¶äº† ğŸ¡</p>
</header>

<main class="p-4 md:p-8">
  <div id="cards" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4"></div>
</main>

<!-- è©³ç´°è¦–çª— -->
<div id="modal" class="hidden fixed inset-0 bg-[#fdf6f7]/90 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl relative flex flex-col md:flex-row overflow-hidden">
    <button id="close-modal" class="absolute top-3 left-3 text-gray-600 text-2xl">âœ–</button>
    <div class="md:w-1/2 bg-gray-100 flex flex-col items-center p-4">
      <img id="main-img" src="" class="w-full rounded-lg mb-3 object-cover aspect-square">
      <div id="thumbs" class="flex gap-2 overflow-x-auto"></div>
    </div>
    <div class="md:w-1/2 p-4 flex flex-col">
      <h3 id="modal-name" class="text-2xl font-bold text-rose-600 mb-2"></h3>
      <p id="modal-info" class="text-gray-600 text-sm mb-4"></p>
      <div id="modal-desc" class="text-gray-700 text-sm flex-1 overflow-y-auto max-h-[70vh] mb-4"></div>

      <div id="adopt-photos" class="bg-gray-50 rounded-xl shadow-inner p-4 mt-3">
        <h4 class="font-semibold mb-2 text-rose-500">å¹¸ç¦åˆç…§ ğŸ’•</h4>
        <div id="adopt-list" class="flex flex-wrap gap-2"></div>
      </div>
    </div>
  </div>
</div>

<script>
const db = firebase.firestore();
const cards = document.getElementById('cards');
const modal = document.getElementById('modal');
const mainImg = document.getElementById('main-img');
const thumbs = document.getElementById('thumbs');
const modalName = document.getElementById('modal-name');
const modalInfo = document.getElementById('modal-info');
const modalDesc = document.getElementById('modal-desc');
const adoptList = document.getElementById('adopt-list');

async function loadPets() {
  cards.innerHTML = '<p class="col-span-full text-center text-gray-400">è¼‰å…¥ä¸­...</p>';
  const snap = await db.collection('adopted').get();
  if (snap.empty) {
    cards.innerHTML = '<p class="col-span-full text-center text-gray-400">ç›®å‰å°šç„¡å·²é ˜é¤Šç´€éŒ„</p>';
    return;
  }
  cards.innerHTML = '';
  snap.forEach(doc => {
    const d = doc.data();
    const card = document.createElement('div');
    card.className = 'bg-white rounded-xl shadow hover:shadow-lg cursor-pointer transition p-2';
    card.innerHTML = `
      <img src="${d.images?.[0] || ''}" class="w-full aspect-square object-cover rounded-lg mb-2"/>
      <p class="text-center text-sm font-medium">${d.name}</p>`;
    card.onclick = () => openModal(d);
    cards.appendChild(card);
  });
}
loadPets();

function openModal(data) {
  document.body.classList.add('modal-open');
  modal.classList.remove('hidden');
  mainImg.src = data.images?.[0] || '';
  thumbs.innerHTML = '';
  data.images?.forEach(u => {
    const img = document.createElement('img');
    img.src = u;
    img.onclick = () => mainImg.src = u;
    thumbs.appendChild(img);
  });
  modalName.textContent = data.name;
  modalInfo.textContent = `${data.type === 'cat' ? 'è²“' : 'ç‹—'}ï½œ${data.breed}ï½œ${data.gender}${data.age ? 'ï½œ' + data.age : ''}`;
  modalDesc.textContent = data.desc || '';
  adoptList.innerHTML = '';
  if (data.adoptPhotos?.length) {
    data.adoptPhotos.forEach(url => {
      const img = document.createElement('img');
      img.src = url;
      img.className = 'w-24 h-24 object-cover rounded-lg';
      adoptList.appendChild(img);
    });
  } else {
    adoptList.innerHTML = '<p class="text-gray-400 text-sm">å°šç„¡åˆç…§</p>';
  }
}

document.getElementById('close-modal').onclick = () => {
  modal.classList.add('hidden');
  document.body.classList.remove('modal-open');
};
</script>
</body>
</html>
