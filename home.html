<!doctype html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å·²é ˜é¤Šç‰†ï½œå°ä¸­ç°¡åª½åª½ç‹—åœ’</title>
  <meta name="description" content="æ›¾è¢«èªé¤Šçš„æ¯›å­©æ•…äº‹èˆ‡åˆç…§ã€‚">
  <meta name="theme-color" content="#fcd34d">
  <link rel="icon" href="data:,">
  <link rel="apple-touch-icon" href="data:,">
  <link rel="stylesheet" href="assets/tailwind.css">
  <link rel="stylesheet" href="assets/shared.css">
</head>

<body class="text-gray-800 bg-gradient-to-br from-brand-50 to-white">
  <!-- Navbar -->
  <header class="bg-white/80 backdrop-blur border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between">
        <a href="index.html" class="flex items-center gap-2 font-semibold text-2xl">
          <span>å°ä¸­ç°¡åª½åª½ç‹—åœ’</span>
        </a>

      <!-- æ¡Œæ©Ÿå°è¦½ -->
      <nav class="hidden md:flex items-center gap-6 ml-auto">
        <a href="cats.html" class="hover:text-brand-600">æˆ‘æƒ³é¤Šè²“å’ª</a>
        <a href="dogs.html" class="hover:text-brand-600">æˆ‘æƒ³é¤Šç‹—ç‹—</a>
        <a href="about.html" class="hover:text-brand-600">é—œæ–¼ç°¡åª½åª½</a>
        <a href="home.html" class="hover:text-brand-600">å¹¸ç¦çš„å®¶</a>
        <a href="admin.html" class="hover:text-brand-600">ç®¡ç†å“¡ç™»å…¥</a>
      </nav>

      <!-- æ‰‹æ©Ÿæ¼¢å ¡éˆ• -->
      <div class="flex items-center gap-2">
          <button id="menuBtn"
            class="md:hidden p-2 rounded-lg border border-[#AEDDEF] bg-white/80 hover:bg-[#AEDDEF]/10" aria-label="é–‹å•Ÿé¸å–®"
            aria-haspopup="menu" aria-expanded="false" aria-controls="menuOverlay">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z" />
          </svg>
        </button>
      </div>
    </div>
    </div>
  </header>
  <!-- é€æ˜è¦†è“‹å±¤ï¼šå°ˆé–€æ¥ã€Œé»å¤–é¢é—œé–‰ã€ -->
  <div id="menuOverlay" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
    <div id="overlayClickArea" class="absolute inset-0"></div>

    <!-- å³ä¸Šè§’å½ˆå‡ºé¸å–®ï¼šå›ºå®šä½ç½®ï¼Œä¸æ¨ç‰ˆï¼Œè¦†è“‹ hero -->
    <nav id="menuPanel" class="fixed opacity-0 scale-y-0 origin-top-right rounded-2xl shadow-xl
            bg-[#AEDDEF] w-fit max-w-[90vw] p-3 transition duration-150 ease-out">
      <!-- å°ç®­é ­ï¼ˆåŒé¢æ¿è‰²ï¼‰ -->
      <div class="absolute -top-2 right-5 w-3 h-3 rotate-45 bg-[#AEDDEF]"></div>

      <!-- æŒ‰éˆ•ç¾¤ï¼šä¿ç•™ space-y-2ã€å­—é«” 18px -->
      <ul class="space-y-2 py-1 text-[18px]" role="menu" aria-orientation="vertical" tabindex="-1">
        <li>
          <a href="cats.html" role="menuitem" tabindex="-1" class="flex items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
                text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
                focus:outline-none focus:ring-2 focus:ring-white/70">
            <span aria-hidden="true" class="text-xl leading-none">ğŸ±</span>
            <span>æˆ‘æƒ³é¤Šè²“å’ª</span>
          </a>
        </li>

        <li>
          <a href="dogs.html" role="menuitem" tabindex="-1" class="flex items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
                text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
                focus:outline-none focus:ring-2 focus:ring-white/70">
            <span aria-hidden="true" class="text-xl leading-none">ğŸ¶</span>
            <span>æˆ‘æƒ³é¤Šç‹—ç‹—</span>
          </a>
        </li>

        <li>
          <a href="about.html" role="menuitem" tabindex="-1" class="flex items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
                text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
                focus:outline-none focus:ring-2 focus:ring-white/70">
            <span aria-hidden="true" class="text-xl leading-none">â„¹ï¸</span>
            <span>é—œæ–¼ç°¡åª½åª½</span>
          </a>
        </li>

        <li>
          <a href="home.html" role="menuitem" tabindex="-1" class="flex items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
            text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
            focus:outline-none focus:ring-2 focus:ring-white/70">
            <span aria-hidden="true" class="text-xl leading-none">ğŸ </span>
            <span>å¹¸ç¦çš„å®¶</span>
          </a>
        </li>

        <li>
          <a href="admin.html" role="menuitem" tabindex="-1" class="flex items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
                text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
                focus:outline-none focus:ring-2 focus:ring-white/70">
            <span aria-hidden="true" class="text-xl leading-none">ğŸ”’</span>
            <span>ç®¡ç†å“¡ç™»å…¥</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
  <script>
    const menuBtn = document.getElementById('menuBtn');
    const overlay = document.getElementById('menuOverlay');
    const clickArea = document.getElementById('overlayClickArea');
    const panel = document.getElementById('menuPanel');

    function positionPanel() {
      const r = menuBtn.getBoundingClientRect();
      const gap = 8;
      panel.style.top = '-1000px';
      panel.style.left = '-1000px';
      const w = panel.offsetWidth;
      let left = r.right - w;
      left = Math.max(8, Math.min(left, window.innerWidth - w - 8));
      panel.style.top = (r.bottom + gap) + 'px';
      panel.style.left = left + 'px';
    }
    function openMenu() {
      overlay.classList.remove('hidden');
      positionPanel();
      requestAnimationFrame(() => {
        panel.classList.remove('opacity-0', 'scale-y-0');
        panel.classList.add('scale-y-100');
      });
      document.addEventListener('keydown', onEsc);
      menuBtn.setAttribute('aria-expanded', 'true');
      const firstItem = panel.querySelector('[role="menuitem"]');
      if (firstItem) firstItem.focus();
    }
    function closeMenu() {
      panel.classList.add('opacity-0');
      panel.classList.remove('scale-y-100');
      panel.classList.add('scale-y-0');
      menuBtn.setAttribute('aria-expanded', 'false');
      document.removeEventListener('keydown', onEsc);
      setTimeout(() => overlay.classList.add('hidden'), 150);
      menuBtn.focus();
    }
    function onEsc(e) { if (e.key === 'Escape') closeMenu(); }

    menuBtn.addEventListener('click', () => {
      const expanded = menuBtn.getAttribute('aria-expanded') === 'true';
      expanded ? closeMenu() : openMenu();
    });
    clickArea.addEventListener('click', (e) => {
      if (!panel.contains(e.target) && e.target !== menuBtn) closeMenu();
    });
    panel.addEventListener('keydown', (e) => {
      const items = Array.from(panel.querySelectorAll('[role="menuitem"]'));
      const i = items.indexOf(document.activeElement);
      if (e.key === 'ArrowDown') { e.preventDefault(); items[(i + 1 + items.length) % items.length].focus(); }
      if (e.key === 'ArrowUp') { e.preventDefault(); items[(i - 1 + items.length) % items.length].focus(); }
      if (e.key === 'Home') { e.preventDefault(); items[0].focus(); }
      if (e.key === 'End') { e.preventDefault(); items[items.length - 1].focus(); }
    });
    window.addEventListener('resize', () => {
      if (!overlay.classList.contains('hidden')) positionPanel();
    });
  </script>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <header class="mb-6">
      <h1 class="text-3xl font-bold" style="text-align: center;"><span aria-hidden="true" class="text-5xl leading-none">ğŸ </span>å¹¸ ç¦ çš„ å®¶<span aria-hidden="true" class="text-5xl leading-none">ğŸ </span></h1>
      <p class="text-gray-600 mt-2">ç‰ å€‘ç¾åœ¨éƒ½æœ‰å®¶äº†ï¼</p>
      <p class="text-black mt-2" style="text-align: center;">ä¹Ÿè®“å…¶ä»–å‹•ç‰©è·Ÿè‘—ä½ ä¸€èµ·å¹¸ç¦ï½</p>
    </header>

    <section>
      <div id="grid" class="mt-4 grid grid-cols-2 gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-50 border-t border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-sm text-gray-500">
      Â© <span id="year"></span> æµªæµªè½‰é‹ç«™ StrayStation. ä¿ç•™æ‰€æœ‰æ¬Šåˆ©ã€‚
    </div>
  </footer>

  <!-- é€™å€‹ dialog æ˜¯ç‚ºäº†è®“ shared.js çš„ç¨‹å¼ä¸å ±éŒ¯ï¼Œç”¨ä¸åˆ°ä¹Ÿæ²’é—œä¿‚ -->
  <dialog id="petDialog"><button id="dlgClose" class="hidden">X</button></dialog>

  <!-- Lightbox -->
  <div id="lightbox" class="fixed inset-0 bg-black/90 hidden items-center justify-center z-[9999]">
    <button id="lbPrev" class="absolute left-3 md:left-10 text-white text-4xl select-none">â®</button>
    <img id="lbImg" class="max-h-[90vh] max-w-[90vw] object-contain rounded-lg" />
    <div id="lbThumbs"
      class="absolute bottom-20 left-0 w-full flex justify-center px-4 py-2 pb-[env(safe-area-inset-bottom)]">
      <div id="lbThumbsInner" class="flex gap-3"></div>
    </div>
    <button id="lbNext" class="absolute right-3 md:right-10 text-white text-4xl select-none">â¯</button>
  </div>


  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js';
    import { getFirestore, collection, query, where, orderBy, getDocs } from 'https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyC4NT2KOm_Cw2OEdaaOimxI0ruoNv_u_9g",
      authDomain: "straystation.firebaseapp.com",
      projectId: "straystation",
      storageBucket: "straystation.firebasestorage.app",
      messagingSenderId: "611366379195",
      appId: "1:611366379195:web:ef5a632e88d8bba1d6139e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const grid = document.getElementById('grid');

    function formatBreed(p) {
      return p.breedType === "ç±³å…‹æ–¯"
        ? `ç±³å…‹æ–¯/${p.breed || ""}`.replace(/\/$/, "")
        : (p.breed || "â€”");
    }

    function formatAge(p) {
      if (!p.age || p.age.trim() === "" || p.age === "â€”") return "å¹´é½¡ä¸è©³";
      return p.age;
    }

    function cardHTML(p) {
      // ç…§ä½ çš„è¦æ ¼ï¼šæ–°åˆç…§å„ªå…ˆï¼ˆæœ€å¤š 5ï¼‰â†’ åŸåœ–ï¼ˆæœ€å¤š 5ï¼‰= æœ€å¤š 10 å¼µ
      const newPhotos = Array.isArray(p.adoptedPhotos) ? p.adoptedPhotos.slice(0, 5) : [];
      const origPhotos = Array.isArray(p.images) ? p.images.slice(0, 5) : [];
      const imgs = [...newPhotos, ...origPhotos];
      const img = imgs[0] || '';

      const photosAttr = JSON.stringify(imgs).replace(/"/g, '&quot;');

      return `
        <article data-photos="${photosAttr}" class="group rounded-2xl overflow-hidden ring-1 ring-gray-200 bg-white hover:shadow-soft transition-shadow snap-start">
          <div class="blur-fit rounded-t-2xl aspect-[4/3]" style="--bg: url('${img}')">
            <img src="${img}" alt="${p.name || 'å‹•ç‰©ç…§ç‰‡'}">
          </div>
          <div class="p-4 flex-1 flex flex-col">
            <!-- ç¬¬ä¸€è¡Œï¼šå·¦é‚Šåå­—ã€å³ä¸Šè§’åœ“è§’æ¨™ç±¤ -->
            <div class="flex items-start justify-between gap-2">
              <h3 class="font-semibold text-lg leading-snug line-clamp-1">${p.name || 'æœªå‘½å'}</h3>
              <span class="shrink-0 rounded-full text-xs px-2 py-1
                ${/(ç‹—|çŠ¬)/.test(String(p.species || '')) ? 'bg-sky-50 text-sky-700' : 'bg-emerald-50 text-emerald-700'}">
                ${/(ç‹—|çŠ¬)/.test(String(p.species || '')) ? 'ç‹—ç‹—' : 'è²“å’ª'}
              </span>
            </div>

            <!-- æ˜ç´°ä¸‰è¡Œ -->
            <div class="mt-2 mb-3 flex flex-col gap-2 text-xs">
              <span class="self-start inline-flex items-center rounded-full bg-gray-100 text-gray-700 px-2.5 py-1 whitespace-nowrap max-w-full truncate">
                ${formatBreed(p)}
              </span>
              <span class="self-start inline-flex items-center rounded-full bg-gray-100 text-gray-700 px-2.5 py-1 whitespace-nowrap max-w-full truncate">
                ${formatAge(p) || 'â€”'}
              </span>
              <span class="self-start inline-flex items-center rounded-full bg-gray-100 text-gray-700 px-2.5 py-1 whitespace-nowrap max-w-full truncate">
                ${p.gender || 'â€”'}
              </span>
            </div>

            
          </div>
        </article>
      `;
    }

    async function loadPets() {
      const qRef = query(collection(db, 'pets'), where('status', '==', 'adopted'), orderBy('createdAt', 'desc'));
      const snap = await getDocs(qRef);
      const all = snap.docs.map(d => ({ id: d.id, ...d.data() }));

      const list = all;
      grid.innerHTML = list.map(cardHTML).join('');
    }

    // é»æ•´å¼µå¡ç‰‡ â†’ ä¸Ÿé€² shared.js çš„ openLightboxï¼ˆç´¢å¼•å¾ 0 é–‹å§‹ï¼‰
    grid.addEventListener('click', (e) => {
      const card = e.target.closest('article[data-photos]');
      if (!card) return;
      const list = JSON.parse(card.getAttribute('data-photos') || '[]');
      if (!list.length) return;
      if (window.openLightbox) window.openLightbox(list, 0);
    });

    loadPets();
  </script>
  <script src="assets/shared.js"></script>
  <script>
    window.closeLightbox = function () {
      const lb = document.getElementById("lightbox");
      if (lb) { lb.classList.add("hidden"); lb.classList.remove("flex"); }
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
    };
  </script>
</body>

</html>