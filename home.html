<!doctype html>
<html lang="zh-Hant-TW">

<head>
  <meta charset="utf-8" />

  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YBC0MQBC2F"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    // è‹¥åœ¨æœ¬æ©Ÿé–‹ç™¼ï¼Œé–‹å•Ÿ DebugViewï¼›æ­£å¼ç«™ä¸æœƒé–‹
    gtag('config', 'G-YBC0MQBC2F', { debug_mode: location.hostname.includes('localhost') });
  </script>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="images/dogpaw-32.png" sizes="32x32" type="image/png">
  <link rel="apple-touch-icon" href="images/dogpaw-180.png">
  <title>å·²é ˜é¤Šç‰†ï½œå°ä¸­ç°¡åª½åª½ç‹—åœ’</title>
  <meta name="description" content="å°ä¸­ç°¡åª½åª½ç‹—åœ’é ˜é¤Šåˆç…§ç‰†ï¼Œè¨˜éŒ„æ¯›å­©æ‰¾åˆ°æ–°å®¶çš„å¹¸ç¦æ™‚åˆ»ï¼Œæ„Ÿè¬æ¯ä¸€ä½èªé¤Šäººçš„æ„›å¿ƒèˆ‡æ”¯æŒã€‚" />
  <meta name="theme-color" content="#fcd34d">
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="stylesheet" href="assets/tailwind.css">
  <style>
    .mosaic-grid {
      display: block;
      column-count: 2;
      column-gap: 12px;
      grid-template-columns: initial;
      grid-auto-rows: initial;
    }

    @media (min-width:768px) {
      .mosaic-grid {
        column-count: 3;
      }
    }

    @media (min-width:1024px) {
      .mosaic-grid {
        column-count: 4;
      }
    }

    .mosaic-grid .itm {
      position: relative;
      overflow: hidden;
      border-radius: 14px;
    }

    .mosaic-grid .itm {
      display: block;
      break-inside: avoid;
      margin-bottom: 12px;
      border-radius: 14px;
      overflow: hidden;
      background: #fff;
      transform: none;
    }

    .mosaic-grid img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .mosaic-grid img {
      display: block;
      width: 100%;
      height: auto;
      object-fit: contain;
    }

    .mosaic-grid .itm:nth-child(2n) {
      transform: translateY(3px);
    }

    .mosaic-grid .itm:nth-child(3n) {
      transform: translateY(-3px);
    }

    /* ä½å‹•æ•ˆåå¥½ */
    @media (prefers-reduced-motion: reduce) {

      .animate-fade-in,
      .animate-bounce-slow {
        animation: none;
      }
    }

    .w-60 {
      width: 15rem;
    }

    @media (min-width: 768px) {
      .hero-text {
        margin-left: 150px;
        /* æƒ³å¤šä¸€é»å°±æ”¹å¤§ï¼Œä¾‹å¦‚ 60pxã€80px */
      }

      .hero-photo {
        margin-right: 150px;
        /* è‡ªå·±èª¿æ•´ */
      }
    }

    /* ç‹—æŒï¼šå–®é»å›é¦–é ã€é•·æŒ‰ç™»å…¥ï¼ˆé¿å… iOS é•·æŒ‰é¸å­—/å‘¼å«é¸å–®ï¼‰ */
    #GoogleLogin {
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    #GoogleLogin img {
      pointer-events: none;
    }

    .pager {
      display: inline-flex;
      align-items: center;
      overflow: hidden;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 1px 2px rgba(0, 0, 0, .05)
    }

    .pager-btn {
      min-width: 38px;
      height: 38px;
      padding: 0 12px;
      border: 0;
      background: transparent;
      color: #6b7280;
      font-size: 14px;
      cursor: pointer
    }

    .pager-btn+.pager-btn {
      border-left: 1px solid #e5e7eb
    }

    .pager-btn:hover {
      background: #f9fafb
    }

    .pager-btn.active {
      color: #ef4444;
      font-weight: 700;
      background: #fff5f5
    }

    .pager-btn:disabled {
      color: #d1d5db;
      cursor: not-allowed;
      background: transparent
    }
  </style>
</head>

<body class="text-gray-800 bg-gradient-to-br from-brand-50 to-white">
  <!-- Navbar -->
  <header class="bg-white/80 backdrop-blur border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="h-16 flex items-center justify-between">
        <a href="index.html" class="flex items-center gap-2 font-semibold text-2xl">
          <img src="images/dogpaw.png" alt="dogpaw" id="GoogleLogin" class="h-8 w-8 object-contain" />
          <span class="flex items-baseline gap-1">
            <span>å°ä¸­ç°¡åª½åª½ç‹—åœ’</span>
            <span id="adminLabel" class="text-sm text-red-500 hidden">æˆ‘æ˜¯å°ç·¨</span>
          </span>
        </a>

        <!-- æ¡Œæ©Ÿå°è¦½ -->
        <nav class="hidden md:flex items-center gap-6 ml-auto">
          <a href="index.html" class="hover:text-brand-600">é¦– é </a>
          <a href="cats.html" class="hover:text-brand-600">æˆ‘æƒ³é¤Šè²“å’ª</a>
          <a href="dogs.html" class="hover:text-brand-600">æˆ‘æƒ³é¤Šç‹—ç‹—</a>
          <a href="about.html" class="hover:text-brand-600">é—œæ–¼ç°¡åª½åª½</a>
          <a href="admin.html" class="hover:text-brand-600 nav-admin-link hidden">å¾Œå°ç®¡ç†</a>
          <button type="button" id="btnLogoutDesktop" class="text-red-500 hover:text-brand-600 nav-logout-btn hidden">
            ç™» å‡º
          </button>
        </nav>

        <!-- æ‰‹æ©Ÿæ¼¢å ¡éˆ• -->
        <div class="flex items-center gap-2">
          <button id="menuBtn"
            class="md:hidden p-2 rounded-lg border border-[#AEDDEF] bg-white/80 hover:bg-[#AEDDEF]/10" aria-label="é–‹å•Ÿé¸å–®"
            aria-haspopup="menu" aria-expanded="false" aria-controls="menuOverlay">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </header>
  <!-- é€æ˜è¦†è“‹å±¤ï¼šå°ˆé–€æ¥ã€Œé»å¤–é¢é—œé–‰ã€ -->
  <div id="menuOverlay" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true">
    <div id="overlayClickArea" class="absolute inset-0"></div>

    <!-- å³ä¸Šè§’å½ˆå‡ºé¸å–®ï¼šå›ºå®šä½ç½®ï¼Œä¸æ¨ç‰ˆï¼Œè¦†è“‹ hero -->
    <nav id="menuPanel" class="fixed opacity-0 scale-y-0 origin-top-right rounded-2xl shadow-xl
            bg-[#AEDDEF] w-fit max-w-[90vw] p-3 transition duration-150 ease-out">
      <!-- å°ç®­é ­ï¼ˆåŒé¢æ¿è‰²ï¼‰ -->
      <div class="absolute -top-2 right-5 w-3 h-3 rotate-45 bg-[#AEDDEF]"></div>

      <!-- æŒ‰éˆ•ç¾¤ï¼šä¿ç•™ space-y-2ã€å­—é«” 18px -->
      <ul class="space-y-2 py-1 text-[18px]" role="menu" aria-orientation="vertical" tabindex="-1">
        <li>
          <a href="index.html" role="menuitem" tabindex="-1" class="flex w-full items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
            text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
            focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white/70
            ">
            <span aria-hidden="true" class="text-xl w-8 text-center leading-none shrink-0">ğŸ§­</span>
            <span class="flex-1 text-center">é¦–&emsp;&emsp;é </span>
          </a>
        </li>

        <li>
          <a href="cats.html" role="menuitem" tabindex="-1" class="flex w-full items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
            text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
            focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white/70
            ">
            <span aria-hidden="true" class="text-xl w-8 text-center leading-none shrink-0">ğŸ±</span>
            <span class="flex-1 text-center">æˆ‘æƒ³é¤Šè²“å’ª</span>
          </a>
        </li>

        <li>
          <a href="dogs.html" role="menuitem" tabindex="-1" class="flex w-full items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
            text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
            focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white/70
            ">
            <span aria-hidden="true" class="text-xl w-8 text-center leading-none shrink-0">ğŸ¶</span>
            <span class="flex-1 text-center">æˆ‘æƒ³é¤Šç‹—ç‹—</span>
          </a>
        </li>

        <li>
          <a href="about.html" role="menuitem" tabindex="-1" class="flex w-full items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
            text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
            focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white/70
            ">
            <span aria-hidden="true" class="text-xl w-8 text-center leading-none shrink-0">â„¹ï¸</span>
            <span class="flex-1 text-center">é—œæ–¼ç°¡åª½åª½</span>
          </a>
        </li>

        <li>
          <a href="admin.html" role="menuitem" tabindex="-1" class="flex w-full items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
            text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
            focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white/70
            nav-admin-link hidden">
            <span aria-hidden="true" class="text-xl w-8 text-center leading-none shrink-0">ğŸ”’</span>
            <span class="flex-1 text-center">å¾Œ&thinsp;å°&thinsp;ç®¡&thinsp;ç†</span>
          </a>
        </li>

        <li>
          <button type="button" role="menuitem" tabindex="-1" class="flex w-full items-center gap-3 whitespace-nowrap rounded-xl bg-white px-4 py-2
            text-slate-700 shadow hover:shadow-md hover:bg-white/95 active:scale-[0.99]
            focus:outline-none focus:ring-0 focus-visible:ring-2 focus-visible:ring-white/70
            nav-logout-btn hidden" id="btnLogoutMobile">
            <span aria-hidden="true" class="text-xl w-8 text-center leading-none shrink-0">ğŸšª</span>
            <span class="flex-1 text-center">ç™»&emsp;&emsp;å‡º</span>
          </button>
        </li>
      </ul>
    </nav>
  </div>
  <script>
    const menuBtn = document.getElementById('menuBtn');
    const overlay = document.getElementById('menuOverlay');
    const clickArea = document.getElementById('overlayClickArea');
    const panel = document.getElementById('menuPanel');

    function positionPanel() {
      const r = menuBtn.getBoundingClientRect();
      const gap = 8;
      panel.style.top = '-1000px';
      panel.style.left = '-1000px';
      const w = panel.offsetWidth;
      let left = r.right - w;
      left = Math.max(8, Math.min(left, window.innerWidth - w - 8));
      panel.style.top = (r.bottom + gap) + 'px';
      panel.style.left = left + 'px';
    }
    function openMenu() {
      overlay.classList.remove('hidden');
      positionPanel();
      requestAnimationFrame(() => {
        panel.classList.remove('opacity-0', 'scale-y-0');
        panel.classList.add('scale-y-100');
      });
      document.addEventListener('keydown', onEsc);
      menuBtn.setAttribute('aria-expanded', 'true');
      const firstItem = panel.querySelector('[role="menuitem"]');
      if (firstItem) firstItem.focus();
    }
    function closeMenu() {
      panel.classList.add('opacity-0');
      panel.classList.remove('scale-y-100');
      panel.classList.add('scale-y-0');
      menuBtn.setAttribute('aria-expanded', 'false');
      document.removeEventListener('keydown', onEsc);
      setTimeout(() => overlay.classList.add('hidden'), 150);
      menuBtn.focus();
    }
    function onEsc(e) { if (e.key === 'Escape') closeMenu(); }

    menuBtn.addEventListener('click', () => {
      const expanded = menuBtn.getAttribute('aria-expanded') === 'true';
      expanded ? closeMenu() : openMenu();
    });
    clickArea.addEventListener('click', (e) => {
      if (!panel.contains(e.target) && e.target !== menuBtn) closeMenu();
    });
    panel.addEventListener('keydown', (e) => {
      const items = Array.from(panel.querySelectorAll('[role="menuitem"]'));
      const i = items.indexOf(document.activeElement);
      if (e.key === 'ArrowDown') { e.preventDefault(); items[(i + 1 + items.length) % items.length].focus(); }
      if (e.key === 'ArrowUp') { e.preventDefault(); items[(i - 1 + items.length) % items.length].focus(); }
      if (e.key === 'Home') { e.preventDefault(); items[0].focus(); }
      if (e.key === 'End') { e.preventDefault(); items[items.length - 1].focus(); }
    });
    window.addEventListener('resize', () => {
      if (!overlay.classList.contains('hidden')) positionPanel();
    });
    // é»ä»»ä½•é¸å–®é …ç›®å¾Œå°±é—œé–‰ï¼ˆé¿å…åœç•™ï¼‰
    panel.querySelectorAll('[role="menuitem"]').forEach(el => {
      el.addEventListener('click', () => { try { closeMenu(); } catch (_) { } });
    });
  </script>

  <!-- Title + Filters + Cards -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <header class="mb-10 md:mb-14 grid grid-cols-1 md:grid-cols-2 items-center gap-8">
      <div class="text-center hero-text">
        <h1 class="text-4xl md:text-5xl font-bold flex justify-center items-center gap-2 mb-4">
          <span aria-hidden="true" class="text-5xl">ğŸ¡</span>
          <span
            class="bg-gradient-to-r from-amber-500 to-pink-500 bg-clip-text text-transparent drop-shadow-sm">å¹¸ç¦çš„æ­¸å®¿</span>
          <span aria-hidden="true" class="text-5xl">ğŸ¡</span>
        </h1>

        <div class="mt-5 flex flex-wrap items-center justify-center gap-3">
          <span
            class="px-3 py-1 rounded-full bg-white/70 ring-1 ring-gray-200 text-sm text-gray-600 inline-block mt-3 mb-3">
            ç›®å‰å·²æœ‰ <b class="text-gray-900" id="adoptedCount">0</b> ä½æ¯›å­©æ‰¾åˆ°å®¶
          </span>
        </div>

        <ul class="space-y-3 text-gray-700 leading-relaxed hero-copy mt-3">
          <li class="flex items-start justify-center gap-3">
            <span aria-hidden="true" class="shrink-0 rounded-full bg-emerald-100 px-2 py-1">ğŸ¾</span>
            <span class="text-gray-700">å°±ç®—æ›¾ç¶“æµæµªï¼Œä¹Ÿèƒ½æ“æœ‰æº«æš–çš„æ‡·æŠ±ã€‚</span>
          </li>
          <li class="flex items-start justify-center gap-3">
            <span aria-hidden="true" class="shrink-0 rounded-full bg-sky-100 px-2 py-1">ğŸŒˆ</span>
            <span class="text-gray-700">è®“ä¸‹ä¸€å€‹å¹¸ç¦çš„æ•…äº‹ï¼Œç”±ä½ å¯«ä¸‹ï½</span>
          </li>
        </ul>
      </div>
      <!-- å³å´ Hero åœ–ï¼ˆæ‰‹æ©Ÿéš±è—ï¼‰ -->
      <div class="hidden md:flex justify-center hero-photo">
        <div class="w-60 rounded-2xl shadow-sm overflow-hidden">
          <img src="images/catwithdog.png" alt="å¹¸ç¦çš„è²“è·Ÿç‹—" class="block w-full h-auto">
        </div>
      </div>
    </header>
    <section class="mb-10">
      <div class="mosaic-grid" id="heroMosaic"></div>

      <!-- åˆ†é å€ -->
      <div id="pagerWrap" class="mt-8 flex flex-col items-center gap-2 hidden">
        <div id="pageInfo" class="text-xs text-gray-500"></div>
        <div id="pager" class="pager"></div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-50 border-t border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-sm text-gray-500">Â© <span id="year"></span>
      <img src="images/æµªæµªè½‰é‹ç«™ Logo.png" alt="æµªæµªè½‰é‹ç«™ Logo"
        style="display:inline-flex;width:1em;height:1em;vertical-align:-0.15em;margin:0.01em -0.25em 0.01em 0.25em;">
      æµªæµªè½‰é‹ç«™ Stray Station. ä¿ç•™æ‰€æœ‰æ¬Šåˆ©ã€‚
    </div>
  </footer>

  <script src="./assets/firebase-config.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs, query, orderBy, where,

    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithRedirect,
      getRedirectResult,
      setPersistence,
      indexedDBLocalPersistence,
      browserLocalPersistence,
      browserSessionPersistence,
      inMemoryPersistence,
      signOut,
      onAuthStateChanged,
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";

    // Firebase Hosting on web.app/custom domain + Safari/Firefox çš„ storage partitioningï¼š
    // authDomain ç›¡é‡ç”¨ã€Œç›®å‰æ­£åœ¨æœå‹™çš„ç¶²åŸŸã€ï¼Œredirect æœƒæ¯”è¼ƒç©©ã€‚
    const __cfg = (window.firebaseConfig ? { ...window.firebaseConfig } : {});
    try {
      const host = window.location.hostname;
      const isLocal =
        host === "localhost" || host === "127.0.0.1" || host === "::1" || host === "";
      if (!isLocal && host) __cfg.authDomain = host;
    } catch (_) { }
    const app = initializeApp(__cfg);
    const db = getFirestore(app);

    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // ===============================
    // Google ç™»å…¥ç™½åå–®ï¼ˆå¾Œå°/ç·¨è¼¯æ¬Šé™ï¼‰
    // ===============================
    // âœ… åªå…è¨±ç™½åå–®å¸³è™Ÿæˆç‚ºã€Œå°ç·¨ã€
    //    - å…ˆç”¨ emails ç²¾æº–æ§ç®¡ï¼›æˆ–æ”¹ç”¨ domains å…è¨±æ•´å€‹ç¶²åŸŸ
    //    - è‹¥å…©å€‹æ¸…å–®éƒ½ç•™ç©ºï¼šç¶­æŒåŸæœ¬è¡Œç‚ºï¼ˆä»»ä½•å¸³è™Ÿç™»å…¥éƒ½ç®—ã€Œå°ç·¨ã€ï¼‰
    const __WL_EMAILS = new Set([
      // "tonyj0721@gmail.com",
      // "cookiech0926@gmail.com",
      // "ccc@gmail.com",
      // "ddd@gmail.com",
      // "eee@gmail.com",
      // "fff@gmail.com",
    ]);
    const __WL_DOMAINS = new Set([
      // "your-org.com",
    ]);

    const __wlNorm = (s) => (s || "").trim().toLowerCase();
    const __wlEnabled = () => (__WL_EMAILS.size > 0 || __WL_DOMAINS.size > 0);
    const __wlAllowed = (user) => {
      if (!__wlEnabled()) return true; // æ²’è¨­å®šç™½åå–®æ™‚ï¼Œç¶­æŒåŸæœ¬è¡Œç‚º
      const email = __wlNorm(user?.email);
      if (!email) return false;
      if (__WL_EMAILS.has(email)) return true;
      const domain = email.split("@")[1];
      if (domain && __WL_DOMAINS.has(domain)) return true;
      return false;
    };

    const LoginBtn = document.getElementById("GoogleLogin");

    async function ensurePersistence() {
      try { await setPersistence(auth, indexedDBLocalPersistence); return; } catch (_) { }
      try { await setPersistence(auth, browserLocalPersistence); return; } catch (_) { }
      try { await setPersistence(auth, browserSessionPersistence); return; } catch (_) { }
      try { await setPersistence(auth, inMemoryPersistence); } catch (_) { }
    }

    // å…ˆè¨­å®šæŒä¹…åŒ–ã€å†æ¥å› redirect çµæœï¼ˆä¸è¼¸å‡ºä»»ä½•æç¤ºï¼‰
    (async () => {
      try { await ensurePersistence(); } catch (_) { }
      try { await getRedirectResult(auth); } catch (_) { }
    })();

    async function startGoogleLogin() {
      if (auth.currentUser) return; // å·²ç™»å…¥å°±ä¸é‡è¤‡ç™»å…¥
      try { await ensurePersistence(); } catch (_) { }
      try { sessionStorage.setItem("__pendingGoogleLogin", "1"); } catch (_) { }
      try { await signInWithRedirect(auth, provider); } catch (_) { }
    }

    // ç‹—æŒï¼šå–®é»å› index.htmlï¼›é•·æŒ‰ >= 650ms è§¸ç™¼ç™»å…¥ï¼ˆä¸ç”¨æ”¾é–‹ï¼‰
    if (LoginBtn) {
      const LONG_PRESS_MS = 650;
      let pressTimer = null;
      let suppressNextClick = false;

      const clearTimer = () => {
        if (pressTimer) { clearTimeout(pressTimer); pressTimer = null; }
      };

      const onDown = (e) => {
        suppressNextClick = false;
        clearTimer();
        pressTimer = setTimeout(() => {
          suppressNextClick = true;
          clearTimer();
          startGoogleLogin();
        }, LONG_PRESS_MS);
      };

      const onUp = () => { clearTimer(); };
      const onCancel = () => { clearTimer(); };

      if ("PointerEvent" in window) {
        LoginBtn.addEventListener("pointerdown", onDown, { passive: false });
        LoginBtn.addEventListener("pointerup", onUp, { passive: true });
        LoginBtn.addEventListener("pointercancel", onCancel, { passive: true });
        LoginBtn.addEventListener("pointerleave", onCancel, { passive: true });
      } else {
        LoginBtn.addEventListener("touchstart", onDown, { passive: false });
        LoginBtn.addEventListener("touchend", onUp, { passive: true });
        LoginBtn.addEventListener("touchcancel", onCancel, { passive: true });
      }

      LoginBtn.addEventListener("click", (e) => {
        if (suppressNextClick) {
          try { e.preventDefault(); } catch (_) { }
          try { e.stopPropagation(); } catch (_) { }
          suppressNextClick = false;
          return;
        }
        window.location.href = "index.html";
      });

      // é¿å… iOS é•·æŒ‰è·³å‡ºé¸å–®ï¼ˆæ‹·è²/é–‹æ–°é ï¼‰
      LoginBtn.addEventListener("contextmenu", (e) => { try { e.preventDefault(); } catch (_) { } });
    }

    const adminLabel = document.getElementById("adminLabel");
    const adminLinks = document.querySelectorAll(".nav-admin-link");
    const logoutBtns = document.querySelectorAll(".nav-logout-btn");

    // ä¾ç™»å…¥ç‹€æ…‹æ›´æ–° header / å°è¦½
    let __wlSigningOut = false;
    onAuthStateChanged(auth, async (user) => {
      const rawLogin = !!user;
      const isLogin = rawLogin && __wlAllowed(user);
      window.__isAdmin = isLogin;

      try { if (rawLogin) sessionStorage.removeItem("__pendingGoogleLogin"); } catch (_) { }

      // æœ‰ç™»å…¥ä½†ä¸åœ¨ç™½åå–®è‡ªå‹•ç™»å‡º
      if (rawLogin && !isLogin && !__wlSigningOut) {
        __wlSigningOut = true;
        try { await signOut(auth); } catch (e) { console.error("signOut failed", e); }
        __wlSigningOut = false;
      }

      adminLabel?.classList.toggle("hidden", !isLogin);

      adminLinks.forEach((el) => {
        el.classList.toggle("hidden", !isLogin);
      });

      logoutBtns.forEach((el) => {
        el.classList.toggle("hidden", !isLogin);
      });
    });

    // æ¡Œæ©Ÿ + æ‰‹æ©Ÿã€Œç™»å‡ºã€æŒ‰éˆ•
    logoutBtns.forEach((btn) => {
      btn.addEventListener("click", async (e) => {
        e.preventDefault();
        try {
          await signOut(auth);

          // å¦‚æœæ‰‹æ©Ÿé¸å–®æœ‰é–‹ï¼ŒæŠŠå®ƒé—œæ‰
          const overlay = document.getElementById("menuOverlay");
          if (overlay) overlay.classList.add("hidden");
        } catch (err) {
          console.error("ç™»å‡ºå¤±æ•—", err);
          alert("ç™»å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
        }
      });
    });

    const grid = document.getElementById('grid');

    function buildMosaic(imgs) {
      const box = document.getElementById('heroMosaic');
      if (!box) return;

      // ä¸åœ¨é€™è£¡é™åˆ¶å¼µæ•¸ï¼Œè®“å¤–é¢åˆ†é æ§åˆ¶
      imgs = (imgs || []).filter(Boolean);

      // è‹¥æ²’æœ‰åœ–ç‰‡ï¼Œæ”¾å¹¾å¼µæ¼¸å±¤å ä½
      if (imgs.length === 0) {
        box.innerHTML = Array.from({ length: 10 }).map(() => (
          `<div class="itm" style="background:linear-gradient(135deg,#fde68a,#fecaca);"></div>`
        )).join('');
        return;
      }

      // ç”¢ç”Ÿæ‹¼è²¼ HTMLï¼ˆç¬¬ 1ã€5 æ ¼åŠ é«˜ï¼‰
      box.innerHTML = imgs.map((src, i) => {
        const tall = (i === 0 || i === 4) ? ' style="grid-row: span 2 / span 2;"' : '';
        return `<div class="itm"${tall}><img src="${src}" alt="adopted photo" loading="lazy"></div>`;
      }).join('');
    }

    // ç°¡å–®çš„å¯é‡ç¾ PRNG
    function mulberry32(a) {
      return function () {
        a |= 0; a = a + 0x6D2B79F5 | 0;
        let t = Math.imul(a ^ a >>> 15, 1 | a);
        t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      };
    }

    async function loadPets() {
      const qRef = query(collection(db, 'pets'), where('status', '==', 'adopted'), orderBy('createdAt', 'desc'));
      const snap = await getDocs(qRef);
      const all = snap.docs.map(d => ({ id: d.id, ...d.data() }));

      const list = all.filter(p => {
        const needs = Array.isArray(p.needsWmPaths) ? p.needsWmPaths : [];
        return needs.length === 0;
      });
      if (grid) grid.innerHTML = list.map(cardHTML).join('');

      // é¡¯ç¤ºå·²é ˜é¤Šæ•¸é‡
      const countEl = document.getElementById('adoptedCount');
      if (countEl) countEl.textContent = String(list.length);

      // è’é›†æ‰€æœ‰å·²é ˜é¤Šç…§ç‰‡
      let allPhotos = [];
      for (const p of list) {
        if (Array.isArray(p.adoptedPhotos)) {
          allPhotos.push(...p.adoptedPhotos);
        }
      }
      // å»é‡è¤‡
      photoList = Array.from(new Set(allPhotos));

      // ä¸€å¾‹å¾ç¬¬ 1 é é–‹å§‹
      currentPage = 1;
      renderCurrentPage();
    }

    // ===== Pagination (1é 10ç­†) =====
    const PAGE_SIZE = 10;
    let currentPage = 1;
    let photoList = [];        // å…¨éƒ¨ç…§ç‰‡çš„ URL

    function renderCurrentPage() {
      const totalItems = photoList.length;
      const totalPages = Math.max(1, Math.ceil(totalItems / PAGE_SIZE));

      if (currentPage > totalPages) currentPage = totalPages;
      if (currentPage < 1) currentPage = 1;

      const start = (currentPage - 1) * PAGE_SIZE;
      const pageItems = photoList.slice(start, start + PAGE_SIZE);

      // âœ… ç”¨åŸæœ¬çš„æ‹¼è²¼å‡½å¼ä¾†ç•«ç•«é¢ï¼Œæ’ç‰ˆé¢¨æ ¼å®Œå…¨ä¿ç•™
      buildMosaic(pageItems);

      updatePager(totalItems, totalPages);
    }

    function updatePager(totalItems, totalPages) {
      const wrap = document.getElementById("pagerWrap");
      const info = document.getElementById("pageInfo");
      const pager = document.getElementById("pager");
      if (!wrap || !info || !pager) return;

      if (totalItems === 0) {
        wrap.classList.add("hidden");
        return;
      }
      wrap.classList.remove("hidden");

      info.textContent = `ç¬¬ ${currentPage}/${totalPages} é `;

      pager.innerHTML = "";
      const makeBtn = (label, targetPage, disabled = false, active = false) => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "pager-btn" + (active ? " active" : "");
        b.textContent = label;
        b.disabled = disabled;
        if (!disabled) {
          b.addEventListener("click", () => {
            currentPage = targetPage;
            renderCurrentPage();
            document.getElementById("heroMosaic")?.scrollIntoView({ behavior: "smooth", block: "start" });
          });
        }
        return b;
      };

      pager.appendChild(makeBtn("Â«", 1, currentPage === 1));
      pager.appendChild(makeBtn("â€¹", Math.max(1, currentPage - 1), currentPage === 1));

      const maxNums = 5;
      let start = Math.max(1, currentPage - Math.floor(maxNums / 2));
      let end = Math.min(totalPages, start + maxNums - 1);
      start = Math.max(1, end - maxNums + 1);

      for (let p = start; p <= end; p++) {
        pager.appendChild(makeBtn(String(p), p, false, p === currentPage));
      }

      pager.appendChild(makeBtn("â€º", Math.min(totalPages, currentPage + 1), currentPage === totalPages));
      pager.appendChild(makeBtn("Â»", totalPages, currentPage === totalPages));
    }

    loadPets();

    const y = document.getElementById('year');
    if (y) y.textContent = new Date().getFullYear();
  </script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", async () => {
        const reg = await navigator.serviceWorker.register("./sw.js");

        // æ¯æ¬¡è¼‰å…¥éƒ½ä¸»å‹•æª¢æŸ¥ sw.js æ˜¯å¦æœ‰æ›´æ–°
        reg.update();

        // å¦‚æœå·²ç¶“æœ‰ waiting çš„æ–°ç‰ˆï¼Œç›´æ¥å«å®ƒä¸Šç·šï¼ˆæ›´ç©©ï¼‰
        if (reg.waiting) {
          reg.waiting.postMessage({ type: "SKIP_WAITING" });
        }

        // æ–°ç‰ˆ SW æ¥æ‰‹å¾Œï¼Œè‡ªå‹•é‡æ•´ä¸€æ¬¡ï¼ˆåŠ  guardï¼Œé¿å…é€£çºŒé‡æ•´ï¼‰
        let reloaded = false;
        navigator.serviceWorker.addEventListener("controllerchange", () => {
          if (reloaded) return;
          reloaded = true;
          window.location.reload();
        });

        // è‹¥ç™¼ç¾æ–°ç‰ˆ SWï¼šå«å®ƒç›´æ¥è·³é waiting
        reg.addEventListener("updatefound", () => {
          const nw = reg.installing;
          if (!nw) return;

          nw.addEventListener("statechange", () => {
            if (nw.state === "installed" && navigator.serviceWorker.controller) {
              (reg.waiting || nw).postMessage({ type: "SKIP_WAITING" });
            }
          });
        });
      });
    }
  </script>
</body>

</html>