<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>浪浪轉運站｜首頁</title>

  <!-- Google Font：與後台相同 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
    }

    /* --- Admin Modal 主圖 --- */
    .modal-main-photo {
      width: 100%;
      max-height: 360px;
      border-radius: 12px;
      object-fit: contain;
      background-color: #f9f9f9;
      display: block;
      margin: 0 auto 10px auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    /* --- Admin Modal 縮圖 --- */
    .modal-photos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(18%, 1fr));
      gap: 6px;
      margin-bottom: 16px;
      justify-items: center;
      align-items: center;
    }

    .modal-photos img {
      width: 100%;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.2s, border-color 0.2s;
    }

    .modal-photos img.active {
      border-color: #f97316;
    }

    .modal-photos img:hover {
      transform: scale(1.05);
    }

    /* 描述（admin 同款） */
    .modal-desc-box {
      background: #fffaf4;
      padding: 14px 16px;
      border-radius: 10px;
      font-size: 0.95rem;
      line-height: 1.7;
      white-space: pre-wrap;
      color: #333;
    }

    dialog::backdrop {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(1px);
    }

    dialog {
      border: none;
      padding: 0;
      border-radius: 16px;
      max-width: 440px;
      width: 100%;
    }
  </style>
</head>
<body class="bg-white">

  <h1 class="text-2xl font-bold p-4">浪浪轉運站（前台）</h1>

  <!-- 寵物列表 -->
  <div id="petList" class="grid grid-cols-2 sm:grid-cols-3 gap-4 p-4"></div>

  <!-- =============================== -->
  <!-- ★★★ Admin Modal（移植到前台） ★★★ -->
  <!-- =============================== -->
  <dialog id="petDialog">

    <div class="p-4 border-b text-center relative">
      <span id="dlgName" class="text-lg font-bold"></span>
      <button id="dlgClose"
              class="absolute right-3 top-2 text-gray-500 hover:text-black text-2xl">&times;</button>
    </div>

    <div class="p-4">

      <!-- 主圖 -->
      <img id="dlgImg" class="modal-main-photo" alt="主圖">

      <!-- 縮圖 -->
      <div id="dlgThumbs" class="modal-photos"></div>

      <!-- 標籤（品種／年齡／性別） -->
      <div id="dlgTags" class="flex flex-wrap gap-2 mb-4"></div>

      <!-- 描述 -->
      <div id="dlgDesc" class="modal-desc-box"></div>

    </div>
  </dialog>
<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC4NT2KOm_Cw2OEdaaOimxI0ruoNv_u_9g",
    authDomain: "straystation.firebaseapp.com",
    projectId: "straystation",
    storageBucket: "straystation.firebasestorage.app",
    messagingSenderId: "611366379195",
    appId: "1:611366379195:web:ef5a632e88d8bba1d6139e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const petList = document.querySelector("#petList");
  const dlg = document.querySelector("#petDialog");
  const dlgClose = document.querySelector("#dlgClose");

  dlgClose.onclick = () => dlg.close();

  // ⭐ 讀 Firestore（前台原本就這樣）
  async function loadPets() {
    const qRef = query(collection(db, "pets"), orderBy("createdAt", "desc"));
    const snap = await getDocs(qRef);

    snap.forEach(doc => {
      const p = { id: doc.id, ...doc.data() };

      const div = document.createElement("div");
      div.className = "bg-white shadow rounded p-3 cursor-pointer";
      div.innerHTML = `
        <img src="${p.images?.[0] || ''}" class="w-full rounded mb-2" />
        <div class="font-bold text-lg">${p.name}</div>
      `;
      div.onclick = () => openModal(p);

      petList.appendChild(div);
    });
  }

  // ⭐ Modal 開啟（Admin 版）
  function openModal(p) {

    document.querySelector("#dlgName").textContent = p.name;
    document.querySelector("#dlgDesc").textContent = p.desc || "";

    // 主圖
    const dlgImg = document.querySelector("#dlgImg");
    dlgImg.src = p.images?.[0] || "";

    // 縮圖列
    const thumbs = document.querySelector("#dlgThumbs");
    thumbs.innerHTML = "";

    (p.images || []).forEach((url, i) => {
      const img = document.createElement("img");
      img.src = url;
      img.className = i === 0 ? "active" : "";
      img.onclick = () => {
        dlgImg.src = url;
        thumbs.querySelectorAll("img").forEach(t => t.classList.remove("active"));
        img.classList.add("active");
      };
      thumbs.appendChild(img);
    });

    // Tags（品種／年齡／性別）
    const tags = document.querySelector("#dlgTags");
    tags.innerHTML = "";

    const t1 = makeTag(p.breedType === "米克斯"
        ? `米克斯 / ${p.breed}`
        : p.breed);
    const t2 = makeTag(p.age);
    const t3 = makeTag(p.gender);

    tags.append(t1, t2, t3);

    dlg.showModal();
  }

  function makeTag(text) {
    const span = document.createElement("span");
    span.className =
      "px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-sm whitespace-nowrap";
    span.textContent = text || "—";
    return span;
  }

  loadPets();
</script>

</body>
</html>
